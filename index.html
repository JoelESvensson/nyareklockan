<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéø #Ny√ÖreKlockan 2026 üèîÔ∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@300;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fireworks-js@2.x/dist/index.umd.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(180deg, 
                #0a1628 0%, 
                #1a3a5c 30%, 
                #2d5a7b 50%,
                #4a7c9b 70%,
                #87a5b8 100%
            );
            font-family: 'Montserrat', sans-serif;
            overflow: hidden;
            position: relative;
            transition: all 0.5s ease;
        }

        body.dramatic-10min {
            background: linear-gradient(180deg, 
                #0a0a1a 0%, 
                #1a2040 30%, 
                #2a3050 50%,
                #3a4060 70%,
                #5a6080 100%
            );
        }

        body.dramatic-1min {
            background: linear-gradient(180deg, 
                #1a0000 0%, 
                #2a0a0a 30%, 
                #3a1010 50%,
                #4a1515 70%,
                #5a2020 100%
            );
            animation: dramaticPulse 0.5s ease-in-out infinite;
        }

        @keyframes dramaticPulse {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        /* Aurora Borealis Effect */
        .aurora {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 60%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(0, 255, 128, 0.1) 40%,
                rgba(0, 200, 255, 0.15) 50%,
                rgba(128, 0, 255, 0.1) 60%,
                transparent 70%
            );
            filter: blur(60px);
            animation: aurora 8s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes aurora {
            0%, 100% { transform: translateX(-20%) skewX(-5deg); opacity: 0.5; }
            50% { transform: translateX(20%) skewX(5deg); opacity: 0.8; }
        }

        /* Stars */
        .stars {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 50%;
            pointer-events: none;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 2s ease-in-out infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        /* Mountains */
        .mountains {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 45%;
            pointer-events: none;
        }

        .mountain {
            position: absolute;
            bottom: 0;
            width: 0;
            height: 0;
            border-style: solid;
        }

        .mountain-1 {
            left: -5%;
            border-width: 0 200px 350px 200px;
            border-color: transparent transparent #1a2a3a transparent;
        }

        .mountain-2 {
            left: 15%;
            border-width: 0 250px 450px 250px;
            border-color: transparent transparent #243444 transparent;
        }

        .mountain-3 {
            left: 45%;
            border-width: 0 300px 500px 300px;
            border-color: transparent transparent #1e2e3e transparent;
        }

        .mountain-4 {
            right: -10%;
            border-width: 0 280px 420px 280px;
            border-color: transparent transparent #2a3a4a transparent;
        }

        /* Snow caps */
        .snow-cap {
            position: absolute;
            bottom: 0;
            width: 0;
            height: 0;
            border-style: solid;
        }

        .snow-cap-1 {
            left: calc(-5% + 140px);
            border-width: 0 60px 80px 60px;
            border-color: transparent transparent #e8f4fc transparent;
            bottom: 270px;
        }

        .snow-cap-2 {
            left: calc(15% + 175px);
            border-width: 0 75px 100px 75px;
            border-color: transparent transparent #f0f8ff transparent;
            bottom: 350px;
        }

        .snow-cap-3 {
            left: calc(45% + 210px);
            border-width: 0 90px 120px 90px;
            border-color: transparent transparent #e8f4fc transparent;
            bottom: 380px;
        }

        .snow-cap-4 {
            right: calc(-10% + 200px);
            border-width: 0 80px 100px 80px;
            border-color: transparent transparent #f0f8ff transparent;
            bottom: 320px;
        }

        /* Ski slope lines */
        .ski-slopes {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 45%;
            pointer-events: none;
        }

        .slope-line {
            position: absolute;
            background: rgba(255, 255, 255, 0.15);
            height: 3px;
            transform-origin: top left;
        }

        /* Snowflakes */
        .snowflakes {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }

        .snowflake {
            position: absolute;
            color: white;
            font-size: 1rem;
            opacity: 0.8;
            animation: fall linear infinite;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
        }

        @keyframes fall {
            0% {
                transform: translateY(-10vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.8;
            }
            90% {
                opacity: 0.8;
            }
            100% {
                transform: translateY(110vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Rain effect */
        .raindrops {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            display: none;
        }

        .raindrops.active {
            display: block;
        }

        .raindrop {
            position: absolute;
            width: 2px;
            height: 15px;
            background: linear-gradient(to bottom, transparent, rgba(174, 194, 224, 0.6));
            animation: rain linear infinite;
        }

        @keyframes rain {
            0% {
                transform: translateY(-10vh);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(110vh);
                opacity: 0;
            }
        }

        /* Fog/mist effect */
        .fog-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: linear-gradient(to bottom, 
                rgba(200, 200, 200, 0.3) 0%,
                rgba(180, 180, 180, 0.2) 50%,
                transparent 100%);
            opacity: 0;
            transition: opacity 2s ease;
        }

        .fog-layer.active {
            opacity: 1;
            animation: fogDrift 20s ease-in-out infinite;
        }

        @keyframes fogDrift {
            0%, 100% { transform: translateX(-5%); }
            50% { transform: translateX(5%); }
        }

        /* Wind streaks effect */
        /* Wind affects snowflakes - CSS variables control drift and speed */
        .snowflakes {
            --wind-drift: 0vw;
            --wind-speed-multiplier: 1;
        }

        .snowflakes .snowflake {
            animation: fallWithWind linear infinite;
            animation-duration: calc(var(--base-duration, 15s) / var(--wind-speed-multiplier));
        }

        .snowflakes .snowflake.from-side {
            animation: fallFromSide linear infinite;
            animation-duration: calc(var(--base-duration, 15s) / var(--wind-speed-multiplier));
        }

        @keyframes fallWithWind {
            0% {
                transform: translateY(-10vh) translateX(0) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.8;
            }
            90% {
                opacity: 0.8;
            }
            100% {
                transform: translateY(110vh) translateX(var(--wind-drift)) rotate(720deg);
                opacity: 0;
            }
        }

        @keyframes fallFromSide {
            0% {
                transform: translateY(var(--start-y, 0vh)) translateX(-20vw) rotate(0deg);
                opacity: 0;
            }
            5% {
                opacity: 0.8;
            }
            90% {
                opacity: 0.8;
            }
            100% {
                transform: translateY(calc(var(--start-y, 0vh) + 110vh)) translateX(calc(var(--wind-drift) + 80vw)) rotate(720deg);
                opacity: 0;
            }
        }

        /* Wind affects rain - CSS variable controls angle and drift */
        .raindrops {
            --wind-drift: 0vw;
            --wind-angle: 0deg;
        }

        .raindrops .raindrop {
            animation: rainWithWind linear infinite;
        }

        @keyframes rainWithWind {
            0% {
                transform: translateY(-10vh) translateX(0) rotate(var(--wind-angle));
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(110vh) translateX(var(--wind-drift)) rotate(var(--wind-angle));
                opacity: 0;
            }
        }

        /* Weather indicator */
        .weather-indicator {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 0.9rem;
            z-index: 50;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .weather-indicator .weather-wind {
            font-size: 0.7rem;
            opacity: 0.7;
        }

        .weather-indicator .weather-icon {
            font-size: 1.5rem;
        }

        .weather-indicator .weather-temp {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.3rem;
            color: #00d4ff;
        }

        .weather-indicator .weather-desc {
            font-size: 0.75rem;
            opacity: 0.8;
            text-transform: capitalize;
        }

        @media (max-width: 480px) {
            .weather-indicator {
                top: 10px;
                left: 10px;
                padding: 8px 12px;
                font-size: 0.8rem;
            }

            .weather-indicator .weather-icon {
                font-size: 1.2rem;
            }

            .weather-indicator .weather-temp {
                font-size: 1.1rem;
            }

            /* Larger, more visible snowflakes on mobile */
            .snowflake {
                font-size: 1.5rem !important;
                opacity: 0.9 !important;
                text-shadow: 0 0 8px rgba(255, 255, 255, 0.7);
            }
        }

        @media (max-width: 768px) {
            /* Medium-sized snowflakes for tablets */
            .snowflake {
                font-size: 1.3rem;
                opacity: 0.85;
            }
        }

        /* Main content */
        .container {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            text-align: center;
        }

        .logo {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.5rem;
            color: white;
            text-shadow: 0 0 30px rgba(0, 200, 255, 0.5);
            margin-bottom: 10px;
            letter-spacing: 8px;
        }

        .logo span {
            color: #00d4ff;
        }

        .subtitle {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 40px;
            letter-spacing: 4px;
            text-transform: uppercase;
        }

        .countdown-container {
            background: rgba(0, 20, 40, 0.6);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 50px 60px;
            border: 2px solid rgba(0, 200, 255, 0.3);
            box-shadow: 
                0 0 60px rgba(0, 200, 255, 0.2),
                inset 0 0 60px rgba(0, 200, 255, 0.05);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 60px rgba(0, 200, 255, 0.2), inset 0 0 60px rgba(0, 200, 255, 0.05); }
            50% { box-shadow: 0 0 80px rgba(0, 200, 255, 0.4), inset 0 0 80px rgba(0, 200, 255, 0.1); }
        }

        .year-display {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 4rem;
            color: #00d4ff;
            text-shadow: 0 0 40px rgba(0, 212, 255, 0.8);
            margin-bottom: 20px;
            letter-spacing: 15px;
        }

        .countdown {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .time-block {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .time-value {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 6rem;
            color: white;
            text-shadow: 
                0 0 20px rgba(255, 255, 255, 0.5),
                0 0 40px rgba(0, 200, 255, 0.5);
            line-height: 1;
            min-width: 140px;
            background: rgba(0, 50, 80, 0.5);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(0, 200, 255, 0.2);
        }

        .time-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-top: 15px;
        }

        .separator {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 5rem;
            color: #00d4ff;
            align-self: center;
            animation: blink 1s ease-in-out infinite;
            margin-bottom: 30px;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Ski icons decoration */
        .ski-decor {
            position: absolute;
            font-size: 3rem;
            opacity: 0.6;
        }

        .ski-left {
            left: 5%;
            top: 20%;
            transform: rotate(-15deg);
            animation: float 6s ease-in-out infinite;
        }

        .ski-right {
            right: 5%;
            top: 25%;
            transform: rotate(15deg);
            animation: float 6s ease-in-out infinite 1s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(-15deg); }
            50% { transform: translateY(-20px) rotate(-10deg); }
        }

        /* Celebration mode */
        .celebration {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 500;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            overflow: hidden;
        }

        .celebration.active {
            display: flex;
        }

        .fireworks-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .celebration-text {
            z-index: 10;
            text-align: center;
            animation: celebrationFadeIn 1s ease-out;
        }

        @keyframes celebrationFadeIn {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Train sub-countdown */
        .train-countdown {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 15px 25px;
            margin-top: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: trainPulse 3s ease-in-out infinite;
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        .train-countdown.departed {
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
        }
        
        @keyframes trainPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(100, 200, 255, 0.3); }
            50% { box-shadow: 0 0 30px rgba(100, 200, 255, 0.5); }
        }
        
        .train-icon {
            font-size: 2.5rem;
            animation: trainWobble 2s ease-in-out infinite;
        }
        
        @keyframes trainWobble {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }
        
        .train-info {
            text-align: left;
        }
        
        .train-title {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 300;
            margin-bottom: 5px;
        }
        
        .train-time {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.8rem;
            color: #7dd3fc;
            letter-spacing: 2px;
        }
        
        .train-time span {
            color: #fff;
        }
        
        @media (max-width: 768px) {
            .train-countdown {
                padding: 12px 18px;
                margin-top: 20px;
            }
            
            .train-icon {
                font-size: 2rem;
            }
            
            .train-title {
                font-size: 0.8rem;
            }
            
            .train-time {
                font-size: 1.4rem;
            }
        }

        @media (max-width: 480px) {
            .train-countdown {
                padding: 10px 14px;
                margin-top: 15px;
                gap: 10px;
            }
            
            .train-icon {
                font-size: 1.6rem;
            }
            
            .train-title {
                font-size: 0.7rem;
            }
            
            .train-time {
                font-size: 1.1rem;
                letter-spacing: 1px;
            }
        }

        @media (max-width: 360px) {
            .train-countdown {
                padding: 8px 12px;
                gap: 8px;
            }
            
            .train-icon {
                font-size: 1.3rem;
            }
            
            .train-title {
                font-size: 0.6rem;
            }
            
            .train-time {
                font-size: 0.95rem;
            }
        }

        .celebration h1 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 12vw;
            color: #ffd700;
            text-shadow: 
                0 0 20px rgba(255, 215, 0, 1),
                0 0 40px rgba(255, 215, 0, 0.8),
                0 0 60px rgba(255, 215, 0, 0.6),
                0 0 80px rgba(255, 100, 0, 0.4),
                0 0 120px rgba(255, 50, 0, 0.3);
            animation: celebratePulse 0.5s ease-in-out infinite alternate;
            margin: 0;
            line-height: 1.1;
        }

        @keyframes celebratePulse {
            from { transform: scale(1); text-shadow: 0 0 20px rgba(255, 215, 0, 1), 0 0 40px rgba(255, 215, 0, 0.8), 0 0 60px rgba(255, 215, 0, 0.6); }
            to { transform: scale(1.05); text-shadow: 0 0 30px rgba(255, 215, 0, 1), 0 0 60px rgba(255, 215, 0, 0.9), 0 0 90px rgba(255, 215, 0, 0.7), 0 0 120px rgba(255, 100, 0, 0.5); }
        }

        .celebration p {
            font-size: 4vw;
            color: white;
            margin-top: 30px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
            font-family: 'Montserrat', sans-serif;
        }

        .celebration .emoji-row {
            font-size: 5vw;
            margin-top: 20px;
            animation: emojiFloat 2s ease-in-out infinite;
        }

        @keyframes emojiFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Ski lift decoration */
        .ski-lift {
            position: absolute;
            bottom: 35%;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(50, 50, 50, 0.8) 20%, 
                rgba(50, 50, 50, 0.8) 80%, 
                transparent 100%
            );
            pointer-events: none;
        }

        .lift-cable {
            position: absolute;
            width: 100%;
            height: 2px;
            background: rgba(100, 100, 100, 0.6);
            top: -20px;
        }

        .gondola {
            position: absolute;
            font-size: 2rem;
            animation: moveGondola 20s linear infinite;
        }

        @keyframes moveGondola {
            0% { left: -5%; }
            100% { left: 105%; }
        }

        /* √Öre sign */
        .are-sign {
            position: absolute;
            bottom: 25%;
            right: 15%;
            background: #8B4513;
            padding: 15px 30px;
            border-radius: 5px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            color: #f5f5dc;
            transform: rotate(-5deg);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 3px solid #654321;
        }

        .are-sign::before {
            content: '';
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 30px;
            background: #654321;
        }

        /* Message */
        .message {
            margin-top: 40px;
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.95);
            text-shadow: 
                0 0 10px rgba(0, 0, 0, 0.8),
                0 0 20px rgba(0, 0, 0, 0.6),
                0 2px 4px rgba(0, 0, 0, 0.9);
            background: rgba(0, 0, 0, 0.3);
            padding: 12px 20px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
            white-space: nowrap;
            text-align: center;
        }

        .message .emoji {
            font-size: 1.5rem;
        }

        /* Memories overlay - shows during last hour */
        .memories-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.8s ease, visibility 0.8s ease;
            background: #000;
        }

        .memories-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Rapid memory mode - background behind countdown during final minute */
        .memories-overlay.rapid-mode {
            z-index: 2; /* Behind countdown but above background */
            opacity: 0.6;
            visibility: visible;
        }

        .memories-overlay.rapid-mode .mini-countdown,
        .memories-overlay.rapid-mode .memory-caption,
        .memories-overlay.rapid-mode .memory-progress {
            display: none;
        }

        .memory-media {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 1s ease;
        }

        .memories-overlay.rapid-mode .memory-media {
            transition: opacity 0.3s ease;
        }

        .memory-media.portrait {
            object-fit: contain;
            background: #000;
        }

        .memory-media.active {
            opacity: 1;
        }

        /* Placeholder memory (gradient backgrounds) */
        .memory-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 1s ease;
        }

        .memory-placeholder.active {
            opacity: 1;
        }

        .memory-placeholder-content {
            text-align: center;
            color: rgba(255, 255, 255, 0.3);
            font-size: 3rem;
        }

        .memory-placeholder-content .placeholder-icon {
            font-size: 8rem;
            margin-bottom: 20px;
            display: block;
        }

        /* Month/year caption overlay */
        .memory-caption {
            position: absolute;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Bebas Neue', sans-serif;
            font-size: 3rem;
            color: white;
            text-shadow: 
                0 0 20px rgba(0, 0, 0, 0.8),
                0 0 40px rgba(0, 0, 0, 0.6),
                0 4px 8px rgba(0, 0, 0, 0.9);
            letter-spacing: 5px;
            z-index: 110;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .memories-overlay.active .memory-caption {
            opacity: 1;
        }

        /* Mini countdown in corner during memories */
        .mini-countdown {
            position: absolute;
            bottom: 30px;
            right: 30px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            padding: 15px 25px;
            border-radius: 15px;
            border: 1px solid rgba(0, 200, 255, 0.3);
            z-index: 110;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .mini-countdown .mini-time {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            color: #00d4ff;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .mini-countdown .mini-label {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .mini-countdown .mini-separator {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            color: rgba(0, 212, 255, 0.5);
        }

        /* Progress bar for memory duration */
        .memory-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 4px;
            background: linear-gradient(90deg, #00d4ff, #ff6b6b);
            z-index: 110;
            transition: width 0.1s linear;
        }

        /* Responsive for memories */
        @media (max-width: 768px) {
            .memory-caption {
                font-size: 2rem;
                bottom: 100px;
            }

            .mini-countdown {
                bottom: 20px;
                right: 20px;
                padding: 10px 15px;
            }

            .mini-countdown .mini-time {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .memory-caption {
                font-size: 1.5rem;
                bottom: 90px;
                letter-spacing: 3px;
            }

            .mini-countdown {
                bottom: 15px;
                right: 15px;
                padding: 8px 12px;
                gap: 6px;
            }

            .mini-countdown .mini-time {
                font-size: 1.2rem;
            }

            .mini-countdown .mini-label {
                display: none;
            }

            .memory-placeholder-content {
                font-size: 1.5rem;
            }

            .memory-placeholder-content .placeholder-icon {
                font-size: 5rem;
            }
        }

        /* Dramatic 10-minute mode */
        .dramatic-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
            opacity: 0;
            transition: opacity 1s ease;
        }

        .dramatic-overlay.active-10min {
            opacity: 1;
            background: radial-gradient(circle at center, transparent 30%, rgba(255, 100, 0, 0.1) 100%);
            animation: warningPulse 2s ease-in-out infinite;
        }

        .dramatic-overlay.active-1min {
            opacity: 1;
            background: radial-gradient(circle at center, transparent 20%, rgba(255, 0, 0, 0.3) 100%);
            animation: urgentPulse 0.5s ease-in-out infinite;
        }

        @keyframes warningPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        @keyframes urgentPulse {
            0%, 100% { opacity: 0.7; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.02); }
        }

        /* Heartbeat ring effect */
        .heartbeat-ring {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            height: 600px;
            border-radius: 50%;
            border: 4px solid transparent;
            pointer-events: none;
            z-index: 6;
            opacity: 0;
        }

        .heartbeat-ring.active-10min {
            opacity: 1;
            border-color: rgba(255, 150, 0, 0.5);
            animation: heartbeat10 2s ease-in-out infinite;
        }

        .heartbeat-ring.active-1min {
            opacity: 1;
            border-color: rgba(255, 50, 50, 0.8);
            animation: heartbeat1 0.5s ease-in-out infinite;
        }

        @keyframes heartbeat10 {
            0%, 100% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.5); opacity: 0.6; }
        }

        @keyframes heartbeat1 {
            0%, 100% { transform: translate(-50%, -50%) scale(0.9); opacity: 0.3; }
            50% { transform: translate(-50%, -50%) scale(1.3); opacity: 1; }
        }

        /* Shake effect for last minute */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .countdown-container.shake {
            animation: shake 0.5s ease-in-out infinite;
        }

        /* Giant countdown for last 10 seconds */
        .giant-countdown {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Bebas Neue', sans-serif;
            font-size: 40vw;
            color: #ff0000;
            text-shadow: 
                0 0 50px rgba(255, 0, 0, 1),
                0 0 100px rgba(255, 0, 0, 0.8),
                0 0 150px rgba(255, 0, 0, 0.6);
            z-index: 50;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.1s ease;
        }

        .giant-countdown.visible {
            opacity: 1;
            animation: countdownPop 1s ease-out;
        }

        @keyframes countdownPop {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            20% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0.9; }
        }

        /* Flashing border for countdown container */
        .countdown-container.urgent {
            border-color: #ff0000 !important;
            animation: borderFlash 0.3s ease-in-out infinite !important;
        }

        @keyframes borderFlash {
            0%, 100% { border-color: #ff0000; box-shadow: 0 0 60px rgba(255, 0, 0, 0.8), inset 0 0 60px rgba(255, 0, 0, 0.2); }
            50% { border-color: #ff6600; box-shadow: 0 0 100px rgba(255, 100, 0, 1), inset 0 0 100px rgba(255, 100, 0, 0.3); }
        }

        /* Screen flash */
        .screen-flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 200;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.1s ease;
        }

        .screen-flash.flash {
            opacity: 0.8;
        }

        /* Dev Panel */
        .dev-panel {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00ff00;
            border-radius: 10px;
            padding: 15px;
            z-index: 1000;
            font-family: monospace;
            font-size: 12px;
            color: #00ff00;
            max-width: 280px;
            display: none;
        }

        .dev-panel.visible {
            display: block;
        }

        .dev-panel h3 {
            margin: 0 0 10px 0;
            color: #ff0;
            font-size: 14px;
            border-bottom: 1px solid #00ff00;
            padding-bottom: 5px;
        }

        .dev-panel label {
            display: block;
            margin: 8px 0 4px 0;
            color: #0ff;
        }

        .dev-panel select,
        .dev-panel input,
        .dev-panel button {
            width: 100%;
            padding: 8px;
            margin: 4px 0;
            background: #111;
            border: 1px solid #00ff00;
            color: #00ff00;
            border-radius: 5px;
            font-family: monospace;
            cursor: pointer;
        }

        .dev-panel button {
            background: #003300;
            font-weight: bold;
            transition: all 0.2s;
        }

        .dev-panel button:hover {
            background: #005500;
        }

        .dev-panel button.active {
            background: #00aa00;
            color: #000;
        }

        .dev-panel .status {
            margin-top: 10px;
            padding: 8px;
            background: #001100;
            border-radius: 5px;
            font-size: 11px;
        }

        .dev-panel .hint {
            color: #666;
            font-size: 10px;
            margin-top: 10px;
        }

        .dev-toggle {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
            color: #666;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 10px;
            cursor: pointer;
            z-index: 999;
            font-family: monospace;
        }

        .dev-toggle:hover {
            border-color: #00ff00;
            color: #00ff00;
        }

        .dev-hidden .dev-toggle,
        .dev-hidden .dev-panel {
            display: none !important;
        }

        .dev-panel .hide-dev-btn {
            background: #8b0000;
            margin-top: 10px;
        }

        .dev-panel .hide-dev-btn:hover {
            background: #a00;
        }

        /* Responsive - Tablets and small laptops */
        @media (max-width: 768px) {
            .time-value {
                font-size: 3.5rem;
                min-width: 80px;
                padding: 15px;
            }
            
            .countdown {
                gap: 10px;
            }
            
            .separator {
                font-size: 3rem;
                margin-bottom: 20px;
            }
            
            .countdown-container {
                padding: 30px 20px;
            }
            
            .year-display {
                font-size: 2.5rem;
                letter-spacing: 8px;
            }

            .logo {
                font-size: 1.8rem;
            }

            .celebration h1 {
                font-size: 4rem;
            }

            .ski-decor {
                display: none;
            }

            .are-sign {
                font-size: 0.9rem;
                padding: 8px 20px;
            }

            .container {
                padding: 10px;
            }

            .message {
                font-size: 1.2rem;
                padding: 15px 25px;
            }
        }

        /* Responsive - Mobile phones */
        @media (max-width: 480px) {
            .logo {
                font-size: 1.3rem;
                margin-bottom: 15px;
            }

            .year-display {
                font-size: 1.8rem;
                letter-spacing: 5px;
                margin-bottom: 15px;
            }

            .countdown {
                gap: 6px;
            }

            .time-value {
                font-size: 2.2rem;
                min-width: 55px;
                padding: 10px 8px;
                border-radius: 10px;
            }

            .time-label {
                font-size: 0.65rem;
                letter-spacing: 1px;
                margin-top: 8px;
            }

            .separator {
                font-size: 2rem;
                margin: 0 -2px;
                margin-bottom: 15px;
            }

            .countdown-container {
                padding: 20px 10px;
            }

            .are-sign {
                font-size: 0.75rem;
                padding: 6px 15px;
                bottom: 15px;
                right: 15px;
            }

            .message {
                font-size: 1rem;
                padding: 12px 18px;
                white-space: normal;
                max-width: 90vw;
            }

            .celebration h1 {
                font-size: 2.5rem;
            }

            .celebration p {
                font-size: 1.5rem;
            }

            /* Giant countdown for mobile */
            .giant-countdown .seconds-display {
                font-size: 30vw;
            }

            .giant-countdown .countdown-label {
                font-size: 1.2rem;
            }

            /* Gondolas smaller on mobile */
            .gondola {
                font-size: 1.5rem;
            }

            /* Mountains scale better */
            .mountain-1 {
                border-width: 0 150px 250px 150px;
            }
            .mountain-2 {
                border-width: 0 175px 300px 175px;
            }
            .mountain-3 {
                border-width: 0 200px 350px 200px;
            }
            .mountain-4 {
                border-width: 0 180px 280px 180px;
            }

            /* Snow caps adjust */
            .snow-cap-1, .snow-cap-2, .snow-cap-3, .snow-cap-4 {
                display: none;
            }
        }

        /* Responsive - Very small phones */
        @media (max-width: 360px) {
            .logo {
                font-size: 1.1rem;
            }

            .year-display {
                font-size: 1.5rem;
                letter-spacing: 3px;
            }

            .time-value {
                font-size: 1.8rem;
                min-width: 45px;
                padding: 8px 6px;
            }

            .time-label {
                font-size: 0.55rem;
            }

            .separator {
                font-size: 1.6rem;
            }

            .countdown-container {
                padding: 15px 8px;
            }

            .message {
                font-size: 0.9rem;
                padding: 10px 15px;
                white-space: normal;
                max-width: 85vw;
            }

            .are-sign {
                font-size: 0.65rem;
                padding: 5px 12px;
            }

            .giant-countdown .seconds-display {
                font-size: 35vw;
            }
        }
    </style>
</head>
<body>
    <div class="aurora"></div>
    
    <div class="stars" id="stars"></div>
    
    <div class="snowflakes" id="snowflakes"></div>
    <div class="raindrops" id="raindrops"></div>
    <div class="fog-layer" id="fog-layer"></div>
    
    <!-- Weather indicator -->
    <div class="weather-indicator" id="weather-indicator" style="display: none;">
        <span class="weather-icon" id="weather-icon">‚ùÑÔ∏è</span>
        <div>
            <div class="weather-temp" id="weather-temp">--¬∞</div>
            <div class="weather-desc" id="weather-desc">Laddar...</div>
            <div class="weather-wind" id="weather-wind"></div>
        </div>
    </div>
    
    <div class="mountains">
        <div class="mountain mountain-1"></div>
        <div class="snow-cap snow-cap-1"></div>
        <div class="mountain mountain-2"></div>
        <div class="snow-cap snow-cap-2"></div>
        <div class="mountain mountain-3"></div>
        <div class="snow-cap snow-cap-3"></div>
        <div class="mountain mountain-4"></div>
        <div class="snow-cap snow-cap-4"></div>
    </div>

    <div class="ski-lift">
        <div class="lift-cable"></div>
        <div class="gondola" style="animation-delay: 0s;">üö°</div>
        <div class="gondola" style="animation-delay: -7s;">üö°</div>
        <div class="gondola" style="animation-delay: -14s;">üö°</div>
    </div>

    <div class="are-sign">√Öreskutan 1420 m.√∂.h.</div>

    <div class="ski-decor ski-left">üéø</div>
    <div class="ski-decor ski-right">üèÇ</div>

    <div class="container">
        <div class="logo">üèîÔ∏è #NY<span>√ÖRE</span>KLOCKAN üéø</div>
        <div class="subtitle">√Öre Ski Resort Edition</div>
        
        <div class="countdown-container" id="countdown-container">
            <div class="year-display" id="year-display">‚è∞</div>
            <div class="countdown">
                <div class="time-block">
                    <div class="time-value" id="days">00</div>
                    <div class="time-label">Dagar</div>
                </div>
                <div class="separator">:</div>
                <div class="time-block">
                    <div class="time-value" id="hours">00</div>
                    <div class="time-label">Timmar</div>
                </div>
                <div class="separator">:</div>
                <div class="time-block">
                    <div class="time-value" id="minutes">00</div>
                    <div class="time-label">Minuter</div>
                </div>
                <div class="separator">:</div>
                <div class="time-block">
                    <div class="time-value" id="seconds">00</div>
                    <div class="time-label">Sekunder</div>
                </div>
            </div>
        </div>

        <div class="message">
            <span class="emoji">‚õ∑Ô∏è</span> R√§kna ner till ett fantastiskt nytt √•r p√• fj√§llet! <span class="emoji">ü•Ç</span>
        </div>
        
        <!-- Sub countdown for train departure -->
        <div class="train-countdown" id="train-countdown">
            <div class="train-icon">üöÇ</div>
            <div class="train-info">
                <div class="train-title">T√•get avg√•r fr√•n Stockholm C</div>
                <div class="train-time">
                    <span id="train-days">0</span>d 
                    <span id="train-hours">00</span>h 
                    <span id="train-minutes">00</span>m 
                    <span id="train-seconds">00</span>s
                </div>
            </div>
        </div>
    </div>

    <div class="celebration" id="celebration">
        <canvas class="fireworks-canvas" id="fireworks-canvas"></canvas>
        <div class="celebration-text">
            <h1>GOTT NYTT √ÖR!</h1>
            <p>V√§lkommen 2026!</p>
            <div class="emoji-row">üéø üèîÔ∏è ü•Ç ‚õ∑Ô∏è üéâ</div>
        </div>
    </div>

    <!-- Memories overlay - shows during last hour -->
    <div class="memories-overlay" id="memories-overlay">
        <div class="memory-container" id="memory-container">
            <!-- Memory media will be inserted here dynamically -->
        </div>
        <div class="memory-caption" id="memory-caption"></div>
        <div class="mini-countdown">
            <div>
                <div class="mini-time" id="mini-hours">00</div>
                <div class="mini-label">Tim</div>
            </div>
            <div class="mini-separator">:</div>
            <div>
                <div class="mini-time" id="mini-minutes">00</div>
                <div class="mini-label">Min</div>
            </div>
            <div class="mini-separator">:</div>
            <div>
                <div class="mini-time" id="mini-seconds">00</div>
                <div class="mini-label">Sek</div>
            </div>
        </div>
        <div class="memory-progress" id="memory-progress"></div>
    </div>

    <!-- Dramatic overlay for final minutes -->
    <div class="dramatic-overlay" id="dramatic-overlay"></div>
    <div class="heartbeat-ring" id="heartbeat-ring"></div>

    <!-- Giant countdown display -->
    <div class="giant-countdown" id="giant-countdown"></div>
    
    <!-- Screen flash effect -->
    <div class="screen-flash" id="screen-flash"></div>

    <!-- Dev Mode Toggle -->
    <button class="dev-toggle" id="dev-toggle" title="Press D to toggle">DEV</button>
    
    <!-- Dev Panel -->
    <div class="dev-panel" id="dev-panel">
        <h3>üõ†Ô∏è DEV MODE</h3>
        
        <label>Simulate Time Remaining:</label>
        <select id="dev-time-preset">
            <option value="">-- Quick Presets --</option>
            <option value="3590000">59:50 (Memories mode)</option>
            <option value="2700000">45 minutes (Memories)</option>
            <option value="1800000">30 minutes (Memories)</option>
            <option value="700000">11+ minutes (Normal)</option>
            <option value="540000">9 minutes (10min mode)</option>
            <option value="300000">5 minutes (10min mode)</option>
            <option value="55000">55 seconds (1min mode)</option>
            <option value="30000">30 seconds (1min mode)</option>
            <option value="10000">10 seconds (Final!)</option>
            <option value="5000">5 seconds (Final!)</option>
            <option value="0">0 - Celebration!</option>
        </select>
        
        <label>Custom Time (seconds):</label>
        <input type="number" id="dev-custom-time" placeholder="Enter seconds..." min="0" max="86400">
        <button id="dev-apply-custom">Apply Custom Time</button>
        
        <button id="dev-reset">Reset to Real Time</button>
        
        <label>Memory Controls:</label>
        <div style="display: flex; gap: 5px;">
            <button id="dev-prev-memory" style="flex: 1;">‚èÆ Prev</button>
            <button id="dev-next-memory" style="flex: 1;">Next ‚è≠</button>
        </div>
        <button id="dev-show-memory">Show Memory Now</button>
        
        <label>Weather Simulation:</label>
        <select id="dev-weather-preset">
            <option value="">-- Live Weather --</option>
            <option value="0">‚òÄÔ∏è Klart</option>
            <option value="3">‚òÅÔ∏è Mulet</option>
            <option value="45">üå´Ô∏è Dimma</option>
            <option value="61">üåßÔ∏è L√§tt regn</option>
            <option value="65">üåßÔ∏è Kraftigt regn</option>
            <option value="71">üå®Ô∏è L√§tt sn√∂fall</option>
            <option value="73">‚ùÑÔ∏è Sn√∂fall</option>
            <option value="75">‚ùÑÔ∏è Kraftigt sn√∂fall</option>
        </select>
        
        <label>Wind Speed: <span id="dev-wind-value">0</span> m/s</label>
        <input type="range" id="dev-wind-speed" min="0" max="25" value="0" style="width: 100%;">
        
        <div class="status">
            <strong>Mode:</strong> <span id="dev-mode-display">normal</span><br>
            <strong>Simulated:</strong> <span id="dev-simulated">No</span><br>
            <strong>Time Left:</strong> <span id="dev-time-display">--</span><br>
            <strong>Memory:</strong> <span id="dev-memory-display">--</span><br>
            <strong>Weather:</strong> <span id="dev-weather-display">--</span>
        </div>
        
        <div class="hint">Press D to toggle this panel</div>
        
        <button id="dev-hide-permanently" class="hide-dev-btn">üö´ Hide Dev Mode</button>
    </div>

    <script>
        // Main countdown: New Year's Eve 2026-01-01 00:00:00 +01:00 (CET)
        const NEW_YEARS_TARGET = new Date('2026-01-01T00:00:00+01:00').getTime();
        
        // Sub countdown: Night train departure from Stockholm C
        const TRAIN_DEPARTURE_TARGET = new Date('2025-12-28T08:11:00+01:00').getTime();
        
        // Main target is New Year's Eve
        const REAL_TARGET_DATE = NEW_YEARS_TARGET;
        
        // Dev mode variables
        let devMode = false;
        let devSimulatedDistance = null;
        let devCountdownActive = false;
        let devIntervalId = null;
        let devSimulatedWeather = null;
        
        // Get effective distance (real or simulated)
        function getDistance() {
            if (devSimulatedDistance !== null) {
                return devSimulatedDistance;
            }
            return REAL_TARGET_DATE - new Date().getTime();
        }
        
        // Check if we're in development mode (localhost)
        const isDevEnvironment = window.location.hostname === 'localhost' || 
                                  window.location.hostname === '127.0.0.1' ||
                                  window.location.hostname === '' ||
                                  window.location.protocol === 'file:';
        
        // Dev panel controls
        document.addEventListener('DOMContentLoaded', () => {
            const devPanel = document.getElementById('dev-panel');
            const devToggle = document.getElementById('dev-toggle');
            const devHideBtn = document.getElementById('dev-hide-permanently');
            
            // Check if dev mode was hidden
            if (localStorage.getItem('devModeHidden') === 'true') {
                document.body.classList.add('dev-hidden');
            }
            const devPreset = document.getElementById('dev-time-preset');
            const devCustomTime = document.getElementById('dev-custom-time');
            const devApplyCustom = document.getElementById('dev-apply-custom');
            const devReset = document.getElementById('dev-reset');
            
            // Hide dev controls in production
            if (!isDevEnvironment) {
                devToggle.style.display = 'none';
                devPanel.style.display = 'none';
                return; // Skip setting up dev panel event listeners
            }
            
            // Toggle dev panel with D key or button
            document.addEventListener('keydown', (e) => {
                if (e.key === 'd' || e.key === 'D') {
                    devPanel.classList.toggle('visible');
                }
            });
            
            devToggle.addEventListener('click', () => {
                devPanel.classList.toggle('visible');
            });
            
            // Hide dev mode permanently
            devHideBtn.addEventListener('click', () => {
                if (confirm('Hide dev mode? You can restore it by clearing localStorage.')) {
                    localStorage.setItem('devModeHidden', 'true');
                    document.body.classList.add('dev-hidden');
                }
            });
            
            // Preset selection
            devPreset.addEventListener('change', (e) => {
                if (e.target.value !== '') {
                    resetDramaticEffects();
                    devSimulatedDistance = parseInt(e.target.value);
                    devCountdownActive = true;
                    startDevCountdown();
                    updateDevStatus();
                }
            });
            
            // Custom time
            devApplyCustom.addEventListener('click', () => {
                const seconds = parseInt(devCustomTime.value);
                if (!isNaN(seconds) && seconds >= 0) {
                    resetDramaticEffects();
                    devSimulatedDistance = seconds * 1000;
                    devCountdownActive = true;
                    startDevCountdown();
                    updateDevStatus();
                }
            });
            
            // Reset
            devReset.addEventListener('click', () => {
                if (devIntervalId) {
                    clearInterval(devIntervalId);
                    devIntervalId = null;
                }
                devSimulatedDistance = null;
                devCountdownActive = false;
                devPreset.value = '';
                devCustomTime.value = '';
                document.getElementById('dev-weather-preset').value = '';
                devSimulatedWeather = null;
                fetchWeather(); // Restore live weather
                resetDramaticEffects();
                updateDevStatus();
            });
            
            // Memory controls
            document.getElementById('dev-prev-memory').addEventListener('click', () => {
                currentMemoryIndex = (currentMemoryIndex - 1 + REAL_MEMORIES.length) % REAL_MEMORIES.length;
                showMemory(currentMemoryIndex);
                updateDevStatus();
            });
            
            document.getElementById('dev-next-memory').addEventListener('click', () => {
                currentMemoryIndex = (currentMemoryIndex + 1) % REAL_MEMORIES.length;
                showMemory(currentMemoryIndex);
                updateDevStatus();
            });
            
            document.getElementById('dev-show-memory').addEventListener('click', () => {
                showMemory(currentMemoryIndex);
                updateDevStatus();
            });
            
            // Weather simulation
            document.getElementById('dev-weather-preset').addEventListener('change', (e) => {
                const windSlider = document.getElementById('dev-wind-speed');
                const windSpeed = windSlider ? parseInt(windSlider.value) : 0;
                
                if (e.target.value === '') {
                    // Restore live weather
                    devSimulatedWeather = null;
                    fetchWeather();
                } else {
                    // Simulate weather
                    const code = parseInt(e.target.value);
                    devSimulatedWeather = { code: code, temp: code >= 71 ? -5 : 8, windSpeed: windSpeed };
                    applyWeatherEffects(devSimulatedWeather);
                    updateWeatherIndicator(devSimulatedWeather);
                }
                updateDevStatus();
            });
            
            // Wind speed slider
            document.getElementById('dev-wind-speed').addEventListener('input', (e) => {
                const windSpeed = parseInt(e.target.value);
                document.getElementById('dev-wind-value').textContent = windSpeed;
                
                // If simulating weather, update wind
                const weatherPreset = document.getElementById('dev-weather-preset');
                if (weatherPreset.value !== '') {
                    const code = parseInt(weatherPreset.value);
                    devSimulatedWeather = { code: code, temp: code >= 71 ? -5 : 8, windSpeed: windSpeed };
                    applyWeatherEffects(devSimulatedWeather);
                    updateWeatherIndicator(devSimulatedWeather);
                } else if (currentWeather) {
                    // Apply wind to current weather for testing
                    const tempWeather = { ...currentWeather, windSpeed: windSpeed };
                    applyWeatherEffects(tempWeather);
                    updateWeatherIndicator(tempWeather);
                } else {
                    // No weather yet, just show wind effects
                    applyWindEffects(windSpeed);
                }
                updateDevStatus();
            });
        });
        
        // Dev countdown timer
        function startDevCountdown() {
            // Clear any existing interval first!
            if (devIntervalId) {
                clearInterval(devIntervalId);
                devIntervalId = null;
            }
            
            if (!devCountdownActive) return;
            
            devIntervalId = setInterval(() => {
                if (!devCountdownActive || devSimulatedDistance === null) {
                    clearInterval(devIntervalId);
                    devIntervalId = null;
                    return;
                }
                devSimulatedDistance = Math.max(0, devSimulatedDistance - 100);
                updateDevStatus();
            }, 100);
        }
        
        // Update dev status display
        function updateDevStatus() {
            const modeDisplay = document.getElementById('dev-mode-display');
            const simDisplay = document.getElementById('dev-simulated');
            const timeDisplay = document.getElementById('dev-time-display');
            const memoryDisplay = document.getElementById('dev-memory-display');
            const weatherDisplay = document.getElementById('dev-weather-display');
            
            if (modeDisplay) modeDisplay.textContent = dramaticMode;
            if (simDisplay) simDisplay.textContent = devSimulatedDistance !== null ? 'Yes' : 'No';
            if (timeDisplay) {
                const d = getDistance();
                const mins = Math.floor(d / 60000);
                const secs = Math.floor((d % 60000) / 1000);
                timeDisplay.textContent = `${mins}m ${secs}s (${d}ms)`;
            }
            if (memoryDisplay && REAL_MEMORIES.length > 0) {
                const filename = REAL_MEMORIES[currentMemoryIndex % REAL_MEMORIES.length].split('/').pop();
                memoryDisplay.textContent = `${currentMemoryIndex + 1}/${REAL_MEMORIES.length} - ${filename}`;
            }
            if (weatherDisplay) {
                if (devSimulatedWeather) {
                    const info = getWeatherInfo(devSimulatedWeather.code);
                    weatherDisplay.textContent = `${info.icon} ${info.desc} (simulated)`;
                } else if (currentWeather) {
                    const info = getWeatherInfo(currentWeather.code);
                    weatherDisplay.textContent = `${info.icon} ${currentWeather.temp}¬∞ ${info.desc}`;
                } else {
                    weatherDisplay.textContent = 'Loading...';
                }
            }
        }
        
        // Reset all dramatic effects
        function resetDramaticEffects() {
            dramaticMode = 'normal';
            lastGiantNumber = -1;
            fireworksStarted = false;
            
            // Stop and clean up fireworks
            stopFireworks();
            
            // Reset memories
            memoriesActive = false;
            lastShownMemoryIndex = -1;
            hideMemory();
            stopRapidMemories();
            
            document.body.classList.remove('dramatic-10min', 'dramatic-1min');
            document.getElementById('dramatic-overlay').classList.remove('active-10min', 'active-1min');
            document.getElementById('heartbeat-ring').classList.remove('active-10min', 'active-1min');
            document.getElementById('countdown-container').classList.remove('shake', 'urgent');
            document.getElementById('countdown-container').style.transform = 'scale(1)';
            document.getElementById('giant-countdown').classList.remove('visible');
            
            // Reset celebration
            const celebration = document.getElementById('celebration');
            celebration.classList.remove('active');
            
            const secondsEl = document.getElementById('seconds');
            secondsEl.style.color = '';
            secondsEl.style.textShadow = '';
            secondsEl.style.transform = '';
        }
        
        // Create stars
        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.animationDelay = Math.random() * 2 + 's';
                star.style.animationDuration = (Math.random() * 2 + 1) + 's';
                starsContainer.appendChild(star);
            }
        }

        // Create snowflakes
        function createSnowflakes(count = 50, windSpeed = 0) {
            const snowflakesContainer = document.getElementById('snowflakes');
            snowflakesContainer.innerHTML = ''; // Clear existing
            const snowflakeChars = ['‚ùÑ', '‚ùÖ', '‚ùÜ', '‚úª', '‚úº', '‚ùã'];
            
            // Calculate how many snowflakes should come from the side based on wind
            // At 25 m/s wind, 50% come from side; at 10 m/s, 20% come from side
            const sideRatio = Math.min(windSpeed / 50, 0.5);
            const sideCount = Math.floor(count * sideRatio);
            const topCount = count - sideCount;
            
            // Create snowflakes falling from top
            for (let i = 0; i < topCount; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.textContent = snowflakeChars[Math.floor(Math.random() * snowflakeChars.length)];
                snowflake.style.left = Math.random() * 100 + '%';
                snowflake.style.fontSize = (Math.random() * 1.5 + 0.5) + 'rem';
                // Set base duration as CSS variable, wind will modify via multiplier
                snowflake.style.setProperty('--base-duration', (Math.random() * 10 + 10) + 's');
                snowflake.style.animationDelay = Math.random() * 10 + 's';
                snowflake.style.opacity = Math.random() * 0.5 + 0.3;
                snowflakesContainer.appendChild(snowflake);
            }
            
            // Create snowflakes entering from the left side (wind-blown)
            for (let i = 0; i < sideCount; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake from-side';
                snowflake.textContent = snowflakeChars[Math.floor(Math.random() * snowflakeChars.length)];
                snowflake.style.left = '-5%'; // Start off-screen left
                snowflake.style.fontSize = (Math.random() * 1.5 + 0.5) + 'rem';
                // Random starting Y position (can start anywhere from top to middle of screen)
                const startY = Math.random() * 50;
                snowflake.style.setProperty('--start-y', startY + 'vh');
                snowflake.style.top = startY + 'vh';
                snowflake.style.setProperty('--base-duration', (Math.random() * 8 + 8) + 's');
                snowflake.style.animationDelay = Math.random() * 10 + 's';
                snowflake.style.opacity = Math.random() * 0.5 + 0.3;
                snowflakesContainer.appendChild(snowflake);
            }
        }

        // Create rain effect
        function createRain(count = 100) {
            const rainContainer = document.getElementById('raindrops');
            rainContainer.innerHTML = ''; // Clear existing
            
            for (let i = 0; i < count; i++) {
                const raindrop = document.createElement('div');
                raindrop.className = 'raindrop';
                raindrop.style.left = Math.random() * 100 + '%';
                raindrop.style.animationDuration = (Math.random() * 0.5 + 0.5) + 's';
                raindrop.style.animationDelay = Math.random() * 2 + 's';
                raindrop.style.opacity = Math.random() * 0.5 + 0.3;
                rainContainer.appendChild(raindrop);
            }
        }

        // Create wind streaks effect
        // Apply wind effects - snowflakes and rain drift based on wind speed
        function applyWindEffects(windSpeed) {
            const snowflakes = document.getElementById('snowflakes');
            const raindrops = document.getElementById('raindrops');
            
            // Calculate drift: 0 m/s = 0vw, 25 m/s = 100vw (steeper angle)
            // This makes snowflakes fall at an increasing angle
            const drift = Math.min(windSpeed * 4, 100);
            const driftValue = drift + 'vw';
            
            // Rain angle: 0 m/s = 0deg, 25 m/s = 60deg (steeper)
            const angle = Math.min(windSpeed * 2.4, 60);
            const angleValue = angle + 'deg';
            
            // Speed multiplier: 0 m/s = 1x, 25 m/s = 4x faster (more dramatic)
            const speedMultiplier = 1 + (windSpeed / 8.33);
            
            // Apply CSS custom properties for dynamic wind effect
            snowflakes.style.setProperty('--wind-drift', driftValue);
            snowflakes.style.setProperty('--wind-speed-multiplier', speedMultiplier);
            raindrops.style.setProperty('--wind-drift', driftValue);
            raindrops.style.setProperty('--wind-angle', angleValue);
        }

        // Weather state
        let currentWeather = null;

        // Fetch weather from Open-Meteo API (free, no API key required)
        async function fetchWeather() {
            // Don't fetch if we have simulated weather
            if (devSimulatedWeather) return;
            
            try {
                // √Öre, Sweden coordinates: 63.3989¬∞ N, 13.0818¬∞ E
                const response = await fetch(
                    'https://api.open-meteo.com/v1/forecast?latitude=63.3989&longitude=13.0818&current=temperature_2m,weather_code,wind_speed_10m&timezone=Europe/Stockholm'
                );
                const data = await response.json();
                
                if (data.current) {
                    currentWeather = {
                        temp: Math.round(data.current.temperature_2m),
                        code: data.current.weather_code,
                        windSpeed: data.current.wind_speed_10m
                    };
                    applyWeatherEffects(currentWeather);
                    updateWeatherIndicator(currentWeather);
                    updateDevStatus();
                }
            } catch (error) {
                console.log('Could not fetch weather:', error);
                // Default to snow if we can't fetch weather
                createSnowflakes(50);
            }
        }

        // WMO Weather interpretation codes
        // https://open-meteo.com/en/docs
        function getWeatherInfo(code) {
            const weatherMap = {
                0: { desc: 'Klart', icon: '‚òÄÔ∏è', type: 'clear' },
                1: { desc: 'Mestadels klart', icon: 'üå§Ô∏è', type: 'clear' },
                2: { desc: 'Delvis molnigt', icon: '‚õÖ', type: 'cloudy' },
                3: { desc: 'Mulet', icon: '‚òÅÔ∏è', type: 'cloudy' },
                45: { desc: 'Dimma', icon: 'üå´Ô∏è', type: 'fog' },
                48: { desc: 'Rimfrost', icon: 'üå´Ô∏è', type: 'fog' },
                51: { desc: 'L√§tt duggregn', icon: 'üåßÔ∏è', type: 'rain' },
                53: { desc: 'Duggregn', icon: 'üåßÔ∏è', type: 'rain' },
                55: { desc: 'Kraftigt duggregn', icon: 'üåßÔ∏è', type: 'rain' },
                56: { desc: 'Underkylt duggregn', icon: 'üåßÔ∏è', type: 'rain' },
                57: { desc: 'Kraftigt underkylt duggregn', icon: 'üåßÔ∏è', type: 'rain' },
                61: { desc: 'L√§tt regn', icon: 'üåßÔ∏è', type: 'rain' },
                63: { desc: 'Regn', icon: 'üåßÔ∏è', type: 'rain' },
                65: { desc: 'Kraftigt regn', icon: 'üåßÔ∏è', type: 'heavyrain' },
                66: { desc: 'Underkylt regn', icon: 'üåßÔ∏è', type: 'rain' },
                67: { desc: 'Kraftigt underkylt regn', icon: 'üåßÔ∏è', type: 'heavyrain' },
                71: { desc: 'L√§tt sn√∂fall', icon: 'üå®Ô∏è', type: 'lightsnow' },
                73: { desc: 'Sn√∂fall', icon: '‚ùÑÔ∏è', type: 'snow' },
                75: { desc: 'Kraftigt sn√∂fall', icon: '‚ùÑÔ∏è', type: 'heavysnow' },
                77: { desc: 'Sn√∂korn', icon: '‚ùÑÔ∏è', type: 'snow' },
                80: { desc: 'L√§tta regnskurar', icon: 'üå¶Ô∏è', type: 'rain' },
                81: { desc: 'Regnskurar', icon: 'üå¶Ô∏è', type: 'rain' },
                82: { desc: 'Kraftiga regnskurar', icon: '‚õàÔ∏è', type: 'heavyrain' },
                85: { desc: 'L√§tta sn√∂byar', icon: 'üå®Ô∏è', type: 'lightsnow' },
                86: { desc: 'Kraftiga sn√∂byar', icon: '‚ùÑÔ∏è', type: 'heavysnow' },
                95: { desc: '√Öskv√§der', icon: '‚õàÔ∏è', type: 'storm' },
                96: { desc: '√Öskv√§der med hagel', icon: '‚õàÔ∏è', type: 'storm' },
                99: { desc: '√Öskv√§der med kraftigt hagel', icon: '‚õàÔ∏è', type: 'storm' }
            };
            return weatherMap[code] || { desc: 'Ok√§nt', icon: '‚ùì', type: 'clear' };
        }

        // Apply weather effects based on current conditions
        function applyWeatherEffects(weather) {
            const info = getWeatherInfo(weather.code);
            const snowflakes = document.getElementById('snowflakes');
            const raindrops = document.getElementById('raindrops');
            const fogLayer = document.getElementById('fog-layer');
            const stars = document.getElementById('stars');
            
            // Reset rain/fog effects (snow is always on)
            raindrops.classList.remove('active');
            fogLayer.classList.remove('active');
            
            // Always show snow for √Öre winter atmosphere
            // Base amount varies by actual weather conditions
            let snowAmount = 40; // Default snow amount
            
            switch (info.type) {
                case 'clear':
                    // Clear sky - light ambient snow, more stars
                    snowAmount = 30;
                    createStars();
                    stars.style.opacity = '1';
                    break;
                    
                case 'cloudy':
                    // Cloudy - moderate snow
                    snowAmount = 45;
                    stars.style.opacity = '0.3';
                    break;
                    
                case 'fog':
                    // Fog - add fog layer, snow through fog
                    snowAmount = 35;
                    fogLayer.classList.add('active');
                    stars.style.opacity = '0.1';
                    break;
                    
                case 'rain':
                    // Rain - still show snow (it's √Öre after all), plus rain
                    snowAmount = 25;
                    createRain(80);
                    raindrops.classList.add('active');
                    stars.style.opacity = '0.1';
                    break;
                    
                case 'heavyrain':
                    // Heavy rain - light snow mixed with rain
                    snowAmount = 20;
                    createRain(150);
                    raindrops.classList.add('active');
                    stars.style.opacity = '0';
                    break;
                    
                case 'lightsnow':
                    // Light snow
                    snowAmount = 50;
                    stars.style.opacity = '0.4';
                    break;
                    
                case 'snow':
                    // Normal snow
                    snowAmount = 70;
                    stars.style.opacity = '0.2';
                    break;
                    
                case 'heavysnow':
                    // Heavy snow
                    snowAmount = 100;
                    stars.style.opacity = '0.1';
                    break;
                    
                default:
                    snowAmount = 50;
            }
            
            // Always create snow
            const windSpeed = weather.windSpeed || 0;
            createSnowflakes(snowAmount, windSpeed);
            
            // Apply wind effects
            applyWindEffects(windSpeed);
        }

        // Update weather indicator display
        function updateWeatherIndicator(weather) {
            const indicator = document.getElementById('weather-indicator');
            const icon = document.getElementById('weather-icon');
            const temp = document.getElementById('weather-temp');
            const desc = document.getElementById('weather-desc');
            const wind = document.getElementById('weather-wind');
            
            const info = getWeatherInfo(weather.code);
            
            icon.textContent = info.icon;
            temp.textContent = `${weather.temp}¬∞`;
            desc.textContent = info.desc;
            
            // Show wind speed
            if (weather.windSpeed !== undefined) {
                wind.textContent = `üí® ${Math.round(weather.windSpeed)} m/s`;
            } else {
                wind.textContent = '';
            }
            
            indicator.style.display = 'flex';
        }

        // Dramatic state tracking
        let dramaticMode = 'normal';
        let lastGiantNumber = -1;
        let fireworksStarted = false;
        let fireworksInstance = null;

        // Countdown logic
        function updateCountdown() {
            const distance = getDistance();
            
            // Update dev status if panel is visible
            updateDevStatus();

            const overlay = document.getElementById('dramatic-overlay');
            const ring = document.getElementById('heartbeat-ring');
            const container = document.getElementById('countdown-container');
            const giantCountdown = document.getElementById('giant-countdown');
            const yearDisplay = document.getElementById('year-display');

            if (distance <= 0) {
                // Time's up!
                document.getElementById('celebration').classList.add('active');
                createFireworks();
                giantCountdown.classList.remove('visible');
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            const totalSeconds = Math.floor(distance / 1000);

            document.getElementById('days').textContent = days.toString().padStart(2, '0');
            document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
            document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
            document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');

            // Update year display based on time remaining
            if (distance > 10 * 60 * 1000) {
                yearDisplay.textContent = '‚è∞';
            } else if (distance > 60 * 1000) {
                yearDisplay.textContent = 'üî• SNART! üî•';
            } else {
                yearDisplay.textContent = 'üí• NU!! üí•';
            }

            // DRAMATIC MODE: Last 10 minutes (600000ms)
            if (distance <= 10 * 60 * 1000 && distance > 60 * 1000) {
                if (dramaticMode !== '10min') {
                    dramaticMode = '10min';
                    document.body.classList.add('dramatic-10min');
                    document.body.classList.remove('dramatic-1min');
                    overlay.classList.add('active-10min');
                    overlay.classList.remove('active-1min');
                    ring.classList.add('active-10min');
                    ring.classList.remove('active-1min');
                    container.classList.remove('shake', 'urgent');
                }
                
                // Pulsing seconds
                const secondsEl = document.getElementById('seconds');
                secondsEl.style.color = '#ff9900';
                secondsEl.style.textShadow = '0 0 30px rgba(255, 153, 0, 0.8)';
                
                // Intensify as we get closer
                const intensity = 1 - (distance / (10 * 60 * 1000));
                container.style.transform = `scale(${1 + intensity * 0.1})`;
            }
            
            // ULTRA DRAMATIC MODE: Last 1 minute (60000ms)
            else if (distance <= 60 * 1000 && distance > 10 * 1000) {
                if (dramaticMode !== '1min') {
                    dramaticMode = '1min';
                    document.body.classList.remove('dramatic-10min');
                    document.body.classList.add('dramatic-1min');
                    overlay.classList.remove('active-10min');
                    overlay.classList.add('active-1min');
                    ring.classList.remove('active-10min');
                    ring.classList.add('active-1min');
                    container.classList.add('shake', 'urgent');
                }
                
                // Red pulsing everything
                const secondsEl = document.getElementById('seconds');
                secondsEl.style.color = '#ff0000';
                secondsEl.style.textShadow = '0 0 50px rgba(255, 0, 0, 1)';
                secondsEl.style.transform = 'scale(1.2)';
                
                // Flash on each second
                if (seconds !== lastGiantNumber) {
                    lastGiantNumber = seconds;
                    flashScreen();
                }
                
                container.style.transform = 'scale(1.15)';
            }
            
            // FINAL COUNTDOWN: Last 10 seconds
            else if (distance <= 10 * 1000 && distance > 0) {
                if (dramaticMode !== 'final') {
                    dramaticMode = 'final';
                    
                    // Make sure all dramatic effects from previous stages are active
                    document.body.classList.remove('dramatic-10min');
                    document.body.classList.add('dramatic-1min');
                    overlay.classList.remove('active-10min');
                    overlay.classList.add('active-1min');
                    ring.classList.remove('active-10min');
                    ring.classList.add('active-1min');
                    container.classList.add('shake', 'urgent');
                    container.style.transform = 'scale(1.15)';
                    
                    const secondsEl = document.getElementById('seconds');
                    secondsEl.style.color = '#ff0000';
                    secondsEl.style.textShadow = '0 0 50px rgba(255, 0, 0, 1)';
                    secondsEl.style.transform = 'scale(1.2)';
                }
                
                // Show giant countdown number - use same calculation as regular seconds display
                const currentSecond = Math.floor((distance % (1000 * 60)) / 1000);
                if (currentSecond !== lastGiantNumber) {
                    lastGiantNumber = currentSecond;
                    giantCountdown.textContent = currentSecond;
                    giantCountdown.classList.remove('visible');
                    void giantCountdown.offsetWidth; // Trigger reflow
                    giantCountdown.classList.add('visible');
                    flashScreen();
                    
                    // Shake the whole page
                    document.body.style.transform = 'translateX(' + (Math.random() * 10 - 5) + 'px)';
                    setTimeout(() => {
                        document.body.style.transform = 'translateX(0)';
                    }, 100);
                }
            }
            
            // Normal mode (more than 10 minutes)
            else if (distance > 10 * 60 * 1000) {
                if (dramaticMode !== 'normal') {
                    dramaticMode = 'normal';
                    document.body.classList.remove('dramatic-10min', 'dramatic-1min');
                    overlay.classList.remove('active-10min', 'active-1min');
                    ring.classList.remove('active-10min', 'active-1min');
                    container.classList.remove('shake', 'urgent');
                    container.style.transform = 'scale(1)';
                    
                    const secondsEl = document.getElementById('seconds');
                    secondsEl.style.color = '';
                    secondsEl.style.textShadow = '';
                    secondsEl.style.transform = '';
                }
            }
        }
        
        // Screen flash effect
        function flashScreen() {
            const flash = document.getElementById('screen-flash');
            flash.classList.add('flash');
            setTimeout(() => {
                flash.classList.remove('flash');
            }, 100);
        }

        // Fireworks effect using fireworks.js
        function createFireworks() {
            if (fireworksStarted) return;
            fireworksStarted = true;
            
            // Hide the main countdown container
            document.querySelector('.container').style.display = 'none';
            document.getElementById('giant-countdown').style.display = 'none';
            document.querySelector('.aurora').style.display = 'none';
            document.querySelector('.mountains').style.display = 'none';
            document.querySelector('.ski-lift').style.display = 'none';
            document.querySelector('.are-sign').style.display = 'none';
            document.querySelectorAll('.ski-decor').forEach(el => el.style.display = 'none');
            document.getElementById('dramatic-overlay').style.display = 'none';
            document.getElementById('heartbeat-ring').style.display = 'none';
            
            // Initialize fireworks.js
            const canvas = document.getElementById('fireworks-canvas');
            fireworksInstance = new Fireworks.default(canvas, {
                autoresize: true,
                opacity: 0.5,
                acceleration: 1.05,
                friction: 0.97,
                gravity: 1.5,
                particles: 80,
                traceLength: 3,
                traceSpeed: 10,
                explosion: 6,
                intensity: 40,
                flickering: 50,
                lineStyle: 'round',
                hue: {
                    min: 0,
                    max: 360
                },
                delay: {
                    min: 15,
                    max: 30
                },
                rocketsPoint: {
                    min: 20,
                    max: 80
                },
                lineWidth: {
                    explosion: {
                        min: 1,
                        max: 4
                    },
                    trace: {
                        min: 1,
                        max: 2
                    }
                },
                brightness: {
                    min: 50,
                    max: 80
                },
                decay: {
                    min: 0.015,
                    max: 0.03
                },
                mouse: {
                    click: true,
                    move: false,
                    max: 3
                }
            });
            
            fireworksInstance.start();
        }
        
        // Stop fireworks (for dev mode reset)
        function stopFireworks() {
            if (fireworksInstance) {
                fireworksInstance.stop(true);
                fireworksInstance = null;
            }
            
            // Show the main elements again
            document.querySelector('.container').style.display = '';
            document.getElementById('giant-countdown').style.display = '';
            document.querySelector('.aurora').style.display = '';
            document.querySelector('.mountains').style.display = '';
            document.querySelector('.ski-lift').style.display = '';
            document.querySelector('.are-sign').style.display = '';
            document.querySelectorAll('.ski-decor').forEach(el => el.style.display = '');
            document.getElementById('dramatic-overlay').style.display = '';
            document.getElementById('heartbeat-ring').style.display = '';
        }

        // ==========================================
        // MEMORIES FEATURE - Last hour before midnight
        // ==========================================
        
        // Memory configuration
        // MEMORIES_START_TIME is calculated after REAL_MEMORIES is defined
        const MEMORY_DISPLAY_DURATION = 20000; // Show each memory for 20 seconds
        const MEMORY_INTERVAL = 60000; // Show a new memory every minute
        
        // Swedish month names
        const MONTH_NAMES_SV = {
            'january': 'Januari',
            'januari': 'Januari',
            'februari': 'Februari',
            'february': 'Februari',
            'mars': 'Mars',
            'march': 'Mars',
            'april': 'April',
            'maj': 'Maj',
            'may': 'Maj',
            'juni': 'Juni',
            'june': 'Juni',
            'juli': 'Juli',
            'july': 'Juli',
            'augusti': 'Augusti',
            'august': 'Augusti',
            'september': 'September',
            'oktober': 'Oktober',
            'october': 'Oktober',
            'november': 'November',
            'december': 'December'
        };
        
        // Real memory files from the memories folder (sorted chronologically)
        const REAL_MEMORIES = [
            'memories/vinter-h√§st.mp4',
            'memories/januari.mp4',
            'memories/januari-zlatan.jpg',
            'memories/januari-√•re.jpeg',
            'memories/februari.mp4',
            'memories/februari-champagne.mp4',
            'memories/februari-fj√§ll.jpg',
            'memories/februari-storlien.jpg',
            'memories/februari-tuva.jpg',
            'memories/februari-venedig.jpg',
            'memories/februari-zlatan.jpg',
            'memories/mars.jpg',
            'memories/mars-2025.jpeg',
            'memories/mars-gaspy.jpeg',
            'memories/mars-hotell-riksgr√§nsen.jpg',
            'memories/mars-mari.jpg',
            'memories/mars-narvik.jpg',
            'memories/mars-narvik-2.jpg',
            'memories/mars-riksgransen.jpeg',
            'memories/mars-riksgr√§nsen.jpg',
            'memories/mars-riksgr√§nsen.jpeg',
            'memories/mars-riksgr√§nsen-emelie.jpg',
            'memories/mars-riksgr√§nsen-ola.jpg',
            'memories/april-s√∂derort-tuva.jpg',
            'memories/maj-aspudden.jpg',
            'memories/maj-b√•t.jpg',
            'memories/maj-sessions.jpeg',
            'memories/maj-sessions.mp4',
            'memories/maj-tuva-2.jpeg',
            'memories/maj-tuva-h√§st.mp4',
            'memories/juni-2025.jpeg',
            'memories/juni-midsommar.jpg',
            'memories/juni-student.jpg',
            'memories/juni-s√§len.jpg',
            'memories/juni-tuva.jpg',
            'memories/juli-cornwall.mp4',
            'memories/juli-cornwall-2.jpeg',
            'memories/juli-dumstrut.jpg',
            'memories/juli-eiffel.jpeg',
            'memories/juli-europapark.jpeg',
            'memories/juli-grisslehamn.jpg',
            'memories/juli-malin.jpeg',
            'memories/juli-oasis.jpg',
            'memories/juli-oasis-2.jpeg',
            'memories/juli-oasis.mp4',
            'memories/juli-ola.jpg',
            'memories/juli-paris.jpg',
            'memories/juli-passfail.jpg',
            'memories/augusti-jarnvg.jpeg',
            'memories/augusti-malin.jpeg',
            'memories/augusti-malin-2.jpeg',
            'memories/augusti-midsommarkransen.jpg',
            'memories/september.jpg',
            'memories/september-br√∂llop.jpg',
            'memories/september-br√∂lop.jpg',
            'memories/september-malin.jpeg',
            'memories/september-ola.jpg',
            'memories/september-tuva.jpg',
            'memories/oktober-gamer.jpeg',
            'memories/oktober-h√§st.jpeg',
            'memories/oktober-huddinge.jpg',
            'memories/oktober-huddinge-2.jpg',
            'memories/oktober-malin.jpeg',
            'memories/november-emelie.jpg',
            'memories/november-ola.jpg',
            'memories/november-slakthuskyrkan.mp4',
            'memories/december-s√∂dermalm.jpeg',
            'memories/december-√•re.mp4',
            'memories/2025-3-emelie.jpg'
        ];
        
        // Start showing memories 12 hours before midnight, one per minute, looping
        const MEMORIES_START_TIME = 12 * 60 * 60 * 1000; // 12 hours in ms
        const MEMORIES_END_TIME = 60 * 1000; // Stop normal memories 1 minute before midnight
        
        // Placeholder memories (gradient backgrounds with icons for each month)
        const PLACEHOLDER_MEMORIES = [
            { month: 'Januari', gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', icon: 'üéø' },
            { month: 'Februari', gradient: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', icon: '‚ù§Ô∏è' },
            { month: 'Mars', gradient: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', icon: 'üå∏' },
            { month: 'April', gradient: 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)', icon: 'üå∑' },
            { month: 'Maj', gradient: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)', icon: '‚òÄÔ∏è' },
            { month: 'Juni', gradient: 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)', icon: 'üåª' },
            { month: 'Juli', gradient: 'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)', icon: 'üèñÔ∏è' },
            { month: 'Augusti', gradient: 'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)', icon: 'üåÖ' },
            { month: 'September', gradient: 'linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%)', icon: 'üçÇ' },
            { month: 'Oktober', gradient: 'linear-gradient(135deg, #fda085 0%, #f6d365 100%)', icon: 'üéÉ' },
            { month: 'November', gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', icon: 'üçÅ' },
            { month: 'December', gradient: 'linear-gradient(135deg, #5ee7df 0%, #b490ca 100%)', icon: 'üéÑ' }
        ];
        
        // Memory state
        let memoriesActive = false;
        let memoryShowTimeout = null;
        let memoryHideTimeout = null;
        let currentMemoryIndex = 0;
        let lastShownMemoryIndex = -1;
        let memoryProgressInterval = null;
        let rapidMemoryMode = false;
        let rapidMemoryInterval = null;
        
        // Season names in Swedish
        const SEASON_NAMES_SV = {
            'vinter': 'Vinter',
            'v√•r': 'V√•r',
            'sommar': 'Sommar',
            'h√∂st': 'H√∂st'
        };
        
        // Parse month/year/season from filename (e.g., "january.jpg" -> { label: "Januari", isYear: false })
        function getMonthFromFilename(filename) {
            const name = filename.toLowerCase().split('.')[0].split('-')[0].split('_')[0];
            
            // Check if it's a year (4 digits)
            if (/^\d{4}$/.test(name)) {
                return { label: name, isYear: true };
            }
            
            // Check if it's a season
            if (SEASON_NAMES_SV[name]) {
                return { label: SEASON_NAMES_SV[name], isYear: true }; // isYear=true to skip ", 2025" suffix
            }
            
            // Check if it's a month
            if (MONTH_NAMES_SV[name]) {
                return { label: MONTH_NAMES_SV[name], isYear: false };
            }
            
            // Default: capitalize first letter
            return { label: name.charAt(0).toUpperCase() + name.slice(1), isYear: false };
        }
        
        // Create a placeholder memory element
        function createPlaceholderMemory(memory) {
            const div = document.createElement('div');
            div.className = 'memory-placeholder';
            div.style.background = memory.gradient;
            div.innerHTML = `
                <div class="memory-placeholder-content">
                    <span class="placeholder-icon">${memory.icon}</span>
                    L√§gg till minnen i /memories/
                </div>
            `;
            return div;
        }
        
        // Create a real memory element (image or video)
        function createRealMemory(src, isVideo) {
            if (isVideo) {
                const video = document.createElement('video');
                video.className = 'memory-media';
                video.src = src;
                video.autoplay = true;
                video.muted = true;
                video.loop = true;
                video.playsInline = true;
                // Detect portrait orientation when metadata loads
                video.addEventListener('loadedmetadata', () => {
                    if (video.videoHeight > video.videoWidth) {
                        video.classList.add('portrait');
                    }
                });
                return video;
            } else {
                const img = document.createElement('img');
                img.className = 'memory-media';
                img.src = src;
                // Detect portrait orientation when image loads
                img.addEventListener('load', () => {
                    if (img.naturalHeight > img.naturalWidth) {
                        img.classList.add('portrait');
                    }
                });
                return img;
            }
        }
        
        // Show a memory
        function showMemory(memoryIndex) {
            const overlay = document.getElementById('memories-overlay');
            const container = document.getElementById('memory-container');
            const caption = document.getElementById('memory-caption');
            const progress = document.getElementById('memory-progress');
            
            // Clear previous memory
            container.innerHTML = '';
            
            let memoryEl;
            let monthName;
            
            // Use real memories if available
            let isYearOrSeason = false;
            if (REAL_MEMORIES.length > 0) {
                const memoryPath = REAL_MEMORIES[memoryIndex % REAL_MEMORIES.length];
                const filename = memoryPath.split('/').pop();
                const isVideo = /\.(mp4|webm)$/i.test(filename);
                
                memoryEl = createRealMemory(memoryPath, isVideo);
                const parsed = getMonthFromFilename(filename);
                monthName = parsed.label;
                isYearOrSeason = parsed.isYear;
            } else {
                // Fall back to placeholders
                const memory = PLACEHOLDER_MEMORIES[memoryIndex % PLACEHOLDER_MEMORIES.length];
                memoryEl = createPlaceholderMemory(memory);
                monthName = memory.month;
            }
            
            container.appendChild(memoryEl);
            
            // Set caption (don't add ", 2025" if it's already a year or season)
            caption.textContent = isYearOrSeason ? monthName : `${monthName}, 2025`;
            
            // Show overlay
            overlay.classList.add('active');
            
            // Fade in the memory element
            setTimeout(() => {
                memoryEl.classList.add('active');
            }, 100);
            
            // Start progress bar animation
            progress.style.width = '0%';
            let progressPercent = 0;
            if (memoryProgressInterval) clearInterval(memoryProgressInterval);
            memoryProgressInterval = setInterval(() => {
                progressPercent += (100 / (MEMORY_DISPLAY_DURATION / 100));
                progress.style.width = Math.min(progressPercent, 100) + '%';
                if (progressPercent >= 100) {
                    clearInterval(memoryProgressInterval);
                }
            }, 100);
            
            // Schedule hide
            if (memoryHideTimeout) clearTimeout(memoryHideTimeout);
            memoryHideTimeout = setTimeout(hideMemory, MEMORY_DISPLAY_DURATION);
        }
        
        // Hide memory overlay
        function hideMemory() {
            const overlay = document.getElementById('memories-overlay');
            const container = document.getElementById('memory-container');
            
            // Fade out memory elements
            const activeMemory = container.querySelector('.active');
            if (activeMemory) {
                activeMemory.classList.remove('active');
            }
            
            // Hide overlay after fade
            setTimeout(() => {
                overlay.classList.remove('active');
            }, 500);
            
            if (memoryProgressInterval) {
                clearInterval(memoryProgressInterval);
            }
        }
        
        // Update mini countdown during memory display
        function updateMiniCountdown() {
            const distance = getDistance();
            
            if (distance <= 0) return;
            
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            
            document.getElementById('mini-hours').textContent = hours.toString().padStart(2, '0');
            document.getElementById('mini-minutes').textContent = minutes.toString().padStart(2, '0');
            document.getElementById('mini-seconds').textContent = seconds.toString().padStart(2, '0');
        }
        
        // Start rapid memory cycling (for final minute)
        function startRapidMemories() {
            if (rapidMemoryMode) return;
            rapidMemoryMode = true;
            
            const overlay = document.getElementById('memories-overlay');
            const container = document.getElementById('memory-container');
            
            // Switch to rapid mode
            overlay.classList.remove('active');
            overlay.classList.add('rapid-mode');
            
            // Clear any scheduled hide
            if (memoryHideTimeout) {
                clearTimeout(memoryHideTimeout);
                memoryHideTimeout = null;
            }
            if (memoryProgressInterval) {
                clearInterval(memoryProgressInterval);
                memoryProgressInterval = null;
            }
            
            // Cycle through memories rapidly
            let rapidIndex = 0;
            
            function showNextRapidMemory() {
                container.innerHTML = '';
                
                if (REAL_MEMORIES.length > 0) {
                    const memoryPath = REAL_MEMORIES[rapidIndex % REAL_MEMORIES.length];
                    const filename = memoryPath.split('/').pop();
                    const isVideo = /\.(mp4|webm)$/i.test(filename);
                    
                    // Only use images for rapid mode (videos would be too slow to load)
                    if (!isVideo) {
                        const img = document.createElement('img');
                        img.className = 'memory-media';
                        img.src = memoryPath;
                        img.addEventListener('load', () => {
                            if (img.naturalHeight > img.naturalWidth) {
                                img.classList.add('portrait');
                            }
                        });
                        container.appendChild(img);
                        
                        // Fade in immediately
                        requestAnimationFrame(() => {
                            img.classList.add('active');
                        });
                    }
                }
                
                rapidIndex++;
            }
            
            // Show first memory immediately
            showNextRapidMemory();
            
            // Then cycle every 500ms, getting faster as we approach zero
            rapidMemoryInterval = setInterval(() => {
                const distance = getDistance();
                if (distance <= 0 || distance > 60 * 1000) {
                    stopRapidMemories();
                    return;
                }
                showNextRapidMemory();
            }, 500);
        }
        
        // Stop rapid memory cycling
        function stopRapidMemories() {
            rapidMemoryMode = false;
            
            if (rapidMemoryInterval) {
                clearInterval(rapidMemoryInterval);
                rapidMemoryInterval = null;
            }
            
            const overlay = document.getElementById('memories-overlay');
            overlay.classList.remove('rapid-mode', 'active');
            
            const container = document.getElementById('memory-container');
            container.innerHTML = '';
        }
        
        // Check if we should show a memory
        function checkMemories() {
            const distance = getDistance();
            
            // RAPID MODE: Last 1 minute (60 seconds to 0)
            if (distance <= 60 * 1000 && distance > 0) {
                if (!rapidMemoryMode) {
                    // Stop normal memory mode
                    if (memoriesActive) {
                        memoriesActive = false;
                        hideMemory();
                    }
                    // Start rapid mode
                    startRapidMemories();
                }
                return;
            }
            
            // Stop rapid mode if we're outside the final minute
            if (rapidMemoryMode) {
                stopRapidMemories();
            }
            
            // NORMAL MODE: From 12 hours before midnight to 1 minute before, 1 memory per minute looping
            if (distance <= MEMORIES_START_TIME && distance > MEMORIES_END_TIME) {
                memoriesActive = true;
                
                // Calculate which minute we're in
                const minutesRemaining = Math.floor(distance / 60000);
                
                // Show a new memory when the minute changes
                if (minutesRemaining !== lastShownMemoryIndex) {
                    lastShownMemoryIndex = minutesRemaining;
                    
                    // Calculate minutes elapsed since start and loop through memories
                    const minutesElapsed = Math.floor((MEMORIES_START_TIME - distance) / 60000);
                    currentMemoryIndex = minutesElapsed % REAL_MEMORIES.length;
                    
                    // Short delay to make the transition feel more natural
                    setTimeout(() => {
                        if (getDistance() > MEMORIES_END_TIME) { // Double-check we're still in normal memory mode
                            showMemory(currentMemoryIndex);
                        }
                    }, 500);
                }
                
                // Update mini countdown
                updateMiniCountdown();
            } else if (distance > MEMORIES_START_TIME) {
                // Outside memory time window entirely
                if (memoriesActive) {
                    memoriesActive = false;
                    hideMemory();
                    lastShownMemoryIndex = -1;
                }
            }
        }
        
        // Add memory check to the update loop
        setInterval(checkMemories, 500);

        // Initialize
        createStars();
        createSnowflakes(); // Default snowflakes until weather loads
        fetchWeather(); // Fetch real weather from √Öre
        setInterval(fetchWeather, 10 * 60 * 1000); // Update weather every 10 minutes
        updateCountdown();
        updateTrainCountdown();
        setInterval(updateCountdown, 100); // Update more frequently for smoother effects
        setInterval(updateTrainCountdown, 1000); // Update train countdown every second
        
        // Train countdown update function
        function updateTrainCountdown() {
            const trainContainer = document.getElementById('train-countdown');
            
            // Calculate train distance based on dev mode or real time
            let distance;
            if (devSimulatedDistance !== null) {
                // Dev mode: Calculate train distance relative to simulated New Year's distance
                // Train departs (NEW_YEARS_TARGET - TRAIN_DEPARTURE_TARGET) ms before New Year's
                const trainToNewYearsDiff = NEW_YEARS_TARGET - TRAIN_DEPARTURE_TARGET;
                distance = devSimulatedDistance - trainToNewYearsDiff;
            } else {
                // Real time
                const now = new Date().getTime();
                distance = TRAIN_DEPARTURE_TARGET - now;
            }
            
            if (distance <= 0) {
                // Train has departed - hide the countdown
                trainContainer.classList.add('departed');
                return;
            } else {
                // Train hasn't departed yet - make sure it's visible
                trainContainer.classList.remove('departed');
            }
            
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            
            document.getElementById('train-days').textContent = days;
            document.getElementById('train-hours').textContent = hours.toString().padStart(2, '0');
            document.getElementById('train-minutes').textContent = minutes.toString().padStart(2, '0');
            document.getElementById('train-seconds').textContent = seconds.toString().padStart(2, '0');
        }

        // Additional dramatic effects interval
        setInterval(() => {
            const distance = getDistance();
            
            // Add extra visual chaos in the last minute
            if (distance <= 60 * 1000 && distance > 0) {
                // Random sparkles
                if (Math.random() > 0.7) {
                    const sparkle = document.createElement('div');
                    sparkle.style.cssText = `
                        position: fixed;
                        left: ${Math.random() * 100}%;
                        top: ${Math.random() * 100}%;
                        width: 10px;
                        height: 10px;
                        background: ${['#ff0', '#f0f', '#0ff', '#fff'][Math.floor(Math.random() * 4)]};
                        border-radius: 50%;
                        pointer-events: none;
                        z-index: 15;
                        animation: explode 0.5s ease-out forwards;
                    `;
                    document.body.appendChild(sparkle);
                    setTimeout(() => sparkle.remove(), 500);
                }
            }
        }, 100);
        
        // Expose functions globally for testing
        window.getDistance = getDistance;
        window.updateCountdown = updateCountdown;
        window.createFireworks = createFireworks;
        window.stopFireworks = stopFireworks;
        window.resetDramaticEffects = resetDramaticEffects;
        window.flashScreen = flashScreen;
        
        // Expose variables for testing (using getters/setters)
        Object.defineProperty(window, 'dramaticMode', {
            get: () => dramaticMode,
            set: (v) => { dramaticMode = v; }
        });
        Object.defineProperty(window, 'lastGiantNumber', {
            get: () => lastGiantNumber,
            set: (v) => { lastGiantNumber = v; }
        });
        Object.defineProperty(window, 'fireworksStarted', {
            get: () => fireworksStarted,
            set: (v) => { fireworksStarted = v; }
        });
        Object.defineProperty(window, 'fireworksInstance', {
            get: () => fireworksInstance,
            set: (v) => { fireworksInstance = v; }
        });
        Object.defineProperty(window, 'devSimulatedDistance', {
            get: () => devSimulatedDistance,
            set: (v) => { devSimulatedDistance = v; }
        });
        Object.defineProperty(window, 'devCountdownActive', {
            get: () => devCountdownActive,
            set: (v) => { devCountdownActive = v; }
        });
    </script>
</body>
</html>
